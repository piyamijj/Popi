<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Piyami LifeOS Ultimate</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #1c1c1e;
            --primary: #32d74b;
            --secondary: #0a84ff;
            --text-main: #ffffff;
            --text-sub: #8e8e93;
            --danger: #ff453a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            padding-bottom: 90px;
            overflow-x: hidden;
            user-select: none;
        }

        body.rtl { direction: rtl; }

        #setupScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 20px;
        }
        .setup-input {
            background: #1c1c1e; border: 1px solid #333;
            color: white; padding: 15px; border-radius: 12px;
            width: 100%; font-size: 1.2rem; text-align: center;
            margin: 20px 0;
        }
        .lang-select { display: flex; gap: 10px; margin-bottom: 20px; }
        .lang-opt {
            padding: 10px 20px; background: #222; border-radius: 8px;
            cursor: pointer; border: 1px solid #333; font-weight: bold;
        }
        .lang-opt.active { background: var(--primary); color: #000; border-color: var(--primary); }

        header {
            padding: 20px 20px 10px 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .greeting-box h1 { font-size: 1.5rem; font-weight: 800; margin-bottom: 2px; }
        .greeting-box p { font-size: 0.85rem; color: var(--text-sub); }
        .location-badge {
            background: rgba(50, 215, 75, 0.15); color: var(--primary);
            padding: 6px 12px; border-radius: 20px; font-size: 0.75rem;
            font-weight: 600; display: flex; align-items: center; gap: 5px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 18px; padding: 20px; margin: 15px 20px;
            position: relative;
        }
        .card-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px;
        }
        .card-title {
            font-size: 0.75rem; color: var(--text-sub); font-weight: 700;
            text-transform: uppercase; letter-spacing: 1px;
        }

        .weather-main { display: flex; align-items: center; gap: 15px; }
        .temp-big { font-size: 2.8rem; font-weight: 700; letter-spacing: -1px; }
        .weather-details { text-align: right; font-size: 0.8rem; color: var(--text-sub); margin-left: auto; }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px; margin-bottom: 15px; }
        .grid-card { background: var(--card-bg); padding: 20px; border-radius: 18px; display: flex; flex-direction: column; justify-content: space-between; }
        .stat-val { font-size: 2rem; font-weight: 800; margin: 10px 0; }
        .btn-small {
            background: rgba(255,255,255,0.1); border: none; color: #fff;
            padding: 8px; border-radius: 8px; font-size: 0.8rem; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 5px;
        }

        .finance-link-btn {
            width: 100%; padding: 15px;
            background: transparent; border: 1px solid var(--primary);
            color: var(--primary); border-radius: 12px; font-weight: 700;
            cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px;
            text-decoration: none; margin-bottom: 5px;
        }
        .converter-box { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .conv-input {
            background: #2c2c2e; border: none; padding: 15px;
            border-radius: 12px; color: white; width: 45%;
            font-size: 1rem; text-align: center;
        }
        .conv-result { font-size: 1.2rem; font-weight: bold; color: var(--primary); margin-left: auto; }

        .chat-container {
            height: 250px; overflow-y: auto;
            background: #151517; border-radius: 12px;
            padding: 10px; margin-bottom: 10px;
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
        }
        .msg { padding: 8px 12px; border-radius: 12px; margin-bottom: 8px; font-size: 0.9rem; max-width: 80%; }
        .msg.bot { background: #333; color: #fff; align-self: flex-start; margin-right: auto; }
        .msg.user { background: var(--secondary); color: #fff; align-self: flex-end; margin-left: auto; text-align: right; }
        .chat-input-area { display: flex; gap: 10px; }
        .translate-area {
            width: 100%; background: #2c2c2e; border: none;
            color: white; padding: 15px; border-radius: 12px;
            font-family: inherit; font-size: 1rem; resize: none;
        }

        .btn-primary {
            width: 100%; padding: 15px;
            background: linear-gradient(90deg, var(--secondary), #0062cc);
            border: none; border-radius: 12px; color: white;
            font-weight: bold; font-size: 1rem; cursor: pointer;
        }
        .btn-green { background: linear-gradient(90deg, var(--primary), #248a33); color: black; }

        .navbar {
            position: fixed; bottom: 0; width: 100%;
            background: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid #333;
            display: flex; justify-content: space-around;
            padding: 15px 0 25px 0; z-index: 100;
        }
        .nav-item { color: #666; font-size: 0.7rem; text-align: center; display: flex; flex-direction: column; align-items: center; transition: 0.3s; cursor: pointer; }
        .nav-item i { font-size: 1.4rem; margin-bottom: 4px; }
        .nav-item.active { color: var(--primary); }

        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from {opacity:0; transform:translateY(5px);} to {opacity:1; transform:translateY(0);} }

        .news-item { padding: 10px 0; border-bottom: 1px solid #333; font-size: 0.9rem; }
        .news-badge { background: #ff3b30; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.65rem; font-weight: bold; margin-right: 5px; }

        /* Calculator Styles */
        .calc-display {
            background: #000; border-radius: 12px; padding: 20px;
            text-align: right; margin-bottom: 15px; min-height: 80px;
            display: flex; flex-direction: column; justify-content: flex-end;
        }
        .calc-history { font-size: 0.8rem; color: var(--text-sub); margin-bottom: 5px; }
        .calc-current { font-size: 2rem; font-weight: 700; color: var(--primary); }
        .calc-memory { font-size: 0.7rem; color: var(--secondary); margin-top: 5px; }
        
        .calc-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .calc-btn {
            background: #2c2c2e; border: none; border-radius: 12px;
            color: white; padding: 20px; font-size: 1.2rem; font-weight: 600;
            cursor: pointer; transition: 0.2s;
        }
        .calc-btn:active { transform: scale(0.95); background: #3c3c3e; }
        .calc-btn.operator { background: var(--secondary); color: white; }
        .calc-btn.special { background: #444; color: var(--primary); }
        .calc-btn.equals { background: var(--primary); color: black; grid-column: span 2; }
        
        .calc-extended {
            max-height: 0; overflow: hidden; transition: max-height 0.3s ease;
            margin-top: 15px;
        }
        .calc-extended.show { max-height: 500px; }
        .calc-extended .calc-buttons { grid-template-columns: repeat(3, 1fr); }
        
        .toggle-extended {
            width: 100%; padding: 10px; background: #2c2c2e;
            border: none; border-radius: 8px; color: var(--text-sub);
            cursor: pointer; margin-bottom: 15px; font-size: 0.9rem;
        }

    </style>
</head>
<body>

    <div id="setupScreen">
        <h1 style="color:var(--primary); margin-bottom:10px">LifeOS Ultimate</h1>
        <p style="color:#666; margin-bottom:30px">System Setup / Sistem Kurulumu</p>
        
        <div class="lang-select">
            <div class="lang-opt active" onclick="selectLang('tr', this)">TR</div>
            <div class="lang-opt" onclick="selectLang('en', this)">EN</div>
            <div class="lang-opt" onclick="selectLang('fa', this)">FA</div>
        </div>

        <input type="text" id="userName" class="setup-input" placeholder="İsim / Name" autocomplete="off">
        
        <button class="btn-primary btn-green" onclick="completeSetup()">BAŞLAT / START</button>
    </div>

    <div id="homePage" class="page active">
        <header>
            <div class="greeting-box">
                <h1 id="greetText">Günaydın Piyami!</h1>
                <p id="dateText">...</p>
            </div>
            <div class="location-badge">
                <i class="fas fa-location-arrow"></i> <span id="locText">Tahran</span>
            </div>
        </header>

        <div class="card">
            <div class="card-header">
                <span class="card-title" data-key="weather">HAVA DURUMU</span>
                <i class="fas fa-cloud-sun" style="color:var(--secondary)"></i>
            </div>
            <div class="weather-main">
                <div class="temp-big" id="tempVal">--°C</div>
                <div style="display:flex; flex-direction:column; justify-content:center;">
                    <span id="weatherCond" style="font-size:1.1rem">Veri Bekleniyor</span>
                </div>
                <div class="weather-details">
                    <div><i class="fas fa-wind"></i> <span id="windVal">-</span> km/s</div>
                    <div style="margin-top:5px"><i class="fas fa-tint"></i> 45%</div>
                </div>
            </div>
        </div>

        <div class="grid-2">
            <div class="grid-card">
                <div class="card-title" data-key="steps">ADIM</div>
                <div class="stat-val" id="stepVal">543</div>
                <button class="btn-small" onclick="toggleSteps()"><i class="fas fa-play"></i> <span data-key="start">Başlat</span></button>
            </div>
            <div class="grid-card">
                <div class="card-title" data-key="pulse">NABIZ</div>
                <div class="stat-val" style="color:var(--danger)" id="pulseVal">--</div>
                <button class="btn-small" onclick="measurePulse(this)"><i class="fas fa-heart-pulse"></i> <span data-key="measure">Ölç</span></button>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <span class="card-title" data-key="agenda">GÜNDEM</span>
                <span style="color:red; font-size:0.7rem; font-weight:bold">● CANLI</span>
            </div>
            <div class="news-item">
                <span class="news-badge">İRAN</span> Tahran Borsasında hareketlilik sürüyor.
            </div>
            <div class="news-item">
                <span class="news-badge">TEKNOLOJİ</span> LifeOS yapay zeka entegrasyonu tamamlandı.
            </div>
            <div class="news-item" style="border:none">
                <span class="news-badge">DÜNYA</span> Global piyasalarda son durum.
            </div>
        </div>
    </div>

    <div id="financePage" class="page">
        <header><h1 style="font-size:1.5rem" data-key="finance">Finans</h1></header>
        
        <div class="card">
            <div class="card-header"><span class="card-title" data-key="markets">PİYASALAR</span></div>
            <p style="color:#666; font-size:0.8rem; margin-bottom:15px">Güncel kurlar için kaynağa git:</p>
            <a href="https://alanchand.com/tr/currencies-price/usd-hav" target="_blank" class="finance-link-btn">
                AlanChand Canlı Kur <i class="fas fa-external-link-alt"></i>
            </a>
        </div>

        <div class="card">
            <div class="card-header"><span class="card-title">ÇEVİRİCİ (Tümen <-> USD)</span></div>
            <div class="converter-box">
                <input type="number" id="tomanInput" class="conv-input" placeholder="Tümen" oninput="calculateUSD()">
                <input type="number" id="rateInput" class="conv-input" value="60000" placeholder="Kur" oninput="calculateUSD()">
            </div>
            <div style="text-align:right; margin-top:15px">
                <span id="usdResult" class="conv-result">= $0.00</span>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <span class="card-title">HESAP MAKİNESİ</span>
                <i class="fas fa-calculator" style="color:var(--primary)"></i>
            </div>
            
            <div class="calc-display">
                <div class="calc-history" id="calcHistory"></div>
                <div class="calc-current" id="calcDisplay">0</div>
                <div class="calc-memory" id="calcMemory"></div>
            </div>

            <button class="toggle-extended" onclick="toggleExtended()">
                <i class="fas fa-chevron-down"></i> Gelişmiş Fonksiyonlar
            </button>

            <div class="calc-buttons">
                <button class="calc-btn special" onclick="calcClear()">C</button>
                <button class="calc-btn special" onclick="calcBackspace()">⌫</button>
                <button class="calc-btn special" onclick="calcPercent()">%</button>
                <button class="calc-btn operator" onclick="calcOp('/')">÷</button>
                
                <button class="calc-btn" onclick="calcNum('7')">7</button>
                <button class="calc-btn" onclick="calcNum('8')">8</button>
                <button class="calc-btn" onclick="calcNum('9')">9</button>
                <button class="calc-btn operator" onclick="calcOp('*')">×</button>
                
                <button class="calc-btn" onclick="calcNum('4')">4</button>
                <button class="calc-btn" onclick="calcNum('5')">5</button>
                <button class="calc-btn" onclick="calcNum('6')">6</button>
                <button class="calc-btn operator" onclick="calcOp('-')">−</button>
                
                <button class="calc-btn" onclick="calcNum('1')">1</button>
                <button class="calc-btn" onclick="calcNum('2')">2</button>
                <button class="calc-btn" onclick="calcNum('3')">3</button>
                <button class="calc-btn operator" onclick="calcOp('+')">+</button>
                
                <button class="calc-btn" onclick="calcNum('0')">0</button>
                <button class="calc-btn" onclick="calcNum('.')">.</button>
                <button class="calc-btn equals" onclick="calcEquals()">=</button>
            </div>

            <div class="calc-extended" id="calcExtended">
                <div class="calc-buttons" style="margin-top:15px">
                    <button class="calc-btn special" onclick="calcMemAdd()">M+</button>
                    <button class="calc-btn special" onclick="calcMemSub()">M−</button>
                    <button class="calc-btn special" onclick="calcMemRecall()">MR</button>
                    
                    <button class="calc-btn special" onclick="calcMemClear()">MC</button>
                    <button class="calc-btn special" onclick="calcSqrt()">√</button>
                    <button class="calc-btn special" onclick="calcPower()">x²</button>
                    
                    <button class="calc-btn special" onclick="calcSin()">sin</button>
                    <button class="calc-btn special" onclick="calcCos()">cos</button>
                    <button class="calc-btn special" onclick="calcTan()">tan</button>
                    
                    <button class="calc-btn special" onclick="calcLog()">log</button>
                    <button class="calc-btn special" onclick="calcLn()">ln</button>
                    <button class="calc-btn special" onclick="calcPi()">π</button>
                </div>
            </div>
        </div>
    </div>

    <div id="aiPage" class="page">
        <header><h1 style="font-size:1.5rem" data-key="assistant">Asistan</h1></header>

        <div class="card">
            <div class="card-header">
                <span class="card-title">AI CHAT (GEMINI 1.5)</span>
                <i class="fas fa-robot" style="color:var(--primary)"></i>
            </div>
            
            <div id="chatHistory" class="chat-container">
                <div class="msg bot" id="welcomeMsg">LifeOS Yapay Zekası devrede. Dünyanın tüm bilgisine erişimim var. Sorun nedir?</div>
            </div>

            <div class="chat-input-area">
                <input type="text" id="userChatInput" class="conv-input" style="width:100%; text-align:left;" placeholder="Bir şey sor..." onkeypress="if(event.key === 'Enter') handleRealChat()">
                <button class="btn-green" id="sendBtn" style="width:50px; border:none; border-radius:12px; cursor:pointer" onclick="handleRealChat()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>

        <div class="card">
            <div class="card-header"><span class="card-title">HIZLI ÇEVİRİ (TR -> FA)</span></div>
            <textarea id="trInput" class="translate-area" rows="3" placeholder="Metni buraya yaz..."></textarea>
            <button class="btn-primary" style="margin-top:10px" onclick="translateReal()">Yapay Zeka ile Çevir</button>
            <div id="faOutput" style="margin-top:15px; color:var(--primary); font-size:1.1rem; min-height:20px; text-align:right; direction:rtl"></div>
        </div>
    </div>

    <nav class="navbar">
        <div class="nav-item active" onclick="navTo('homePage', this)">
            <i class="fas fa-home"></i> <span data-key="home">Ana Sayfa</span>
        </div>
        <div class="nav-item" onclick="navTo('financePage', this)">
            <i class="fas fa-wallet"></i> <span data-key="finance">Finans</span>
        </div>
        <div class="nav-item" onclick="navTo('aiPage', this)">
            <i class="fas fa-brain"></i> <span data-key="assistant">Asistan</span>
        </div>
    </nav>

    <script>
        const GEMINI_API_KEY = "AIzaSyAbS5kteGtX1t40odM-RWQ_n9m24Ss-JcY";

        const appState = {
            lang: 'tr',
            name: 'Piyami'
        };

        const dictionary = {
            tr: { home: "Ana Sayfa", finance: "Finans", assistant: "Asistan", weather: "HAVA DURUMU", steps: "ADIM", pulse: "NABIZ", agenda: "GÜNDEM", markets: "PİYASALAR", start: "Başlat", measure: "Ölç" },
            en: { home: "Home", finance: "Finance", assistant: "Assistant", weather: "WEATHER", steps: "STEPS", pulse: "PULSE", agenda: "NEWS", markets: "MARKETS", start: "Start", measure: "Measure" },
            fa: { home: "خانه", finance: "مالی", assistant: "دستیار", weather: "آب و هوا", steps: "گام‌شمار", pulse: "ضربان", agenda: "اخبار", markets: "بازارها", start: "شروع", measure: "اندازه‌گیری" }
        };

        // Calculator State
        const calcState = {
            current: '0',
            previous: '',
            operator: null,
            memory: 0,
            history: []
        };

        window.onload = function() {
            const stored = localStorage.getItem('lifeos_v5_data');
            if (stored) {
                const data = JSON.parse(stored);
                appState.name = data.name;
                appState.lang = data.lang;
                document.getElementById('setupScreen').style.display = 'none';
                initApp();
            }
            
            // Load calculator memory
            const calcMem = localStorage.getItem('calc_memory');
            if(calcMem) calcState.memory = parseFloat(calcMem);
        };

        function selectLang(l, el) {
            appState.lang = l;
            document.querySelectorAll('.lang-opt').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function completeSetup() {
            const nameIn = document.getElementById('userName').value.trim();
            if(!nameIn) return alert("Lütfen isim girin");
            
            appState.name = nameIn;
            localStorage.setItem('lifeos_v5_data', JSON.stringify(appState));
            document.getElementById('setupScreen').style.display = 'none';
            initApp();
        }

        function initApp() {
            document.body.classList.remove('rtl');
            if(appState.lang === 'fa') document.body.classList.add('rtl');

            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if(dictionary[appState.lang][key]) el.innerText = dictionary[appState.lang][key];
            });

            const hour = new Date().getHours();
            let greeting = "";
            if(appState.lang === 'tr') greeting = hour < 12 ? "Günaydın" : "İyi Akşamlar";
            else if(appState.lang === 'en') greeting = hour < 12 ? "Good Morning" : "Good Evening";
            else greeting = hour < 12 ? "صبح بخیر" : "عصر بخیر";
            
            document.getElementById('greetText').innerText = `${greeting} ${appState.name}!`;

            const opts = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const locale = appState.lang === 'fa' ? 'fa-IR' : 'tr-TR';
            document.getElementById('dateText').innerText = new Date().toLocaleDateString(locale, opts);

            getWeather();
        }

        function navTo(pageId, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }

        function getWeather() {
            fetch(`https://api.open-meteo.com/v1/forecast?latitude=35.6892&longitude=51.3890&current_weather=true`)
            .then(r => r.json())
            .then(data => {
                const temp = Math.round(data.current_weather.temperature);
                document.getElementById('tempVal').innerText = temp + "°C";
                document.getElementById('weatherCond').innerText = temp > 20 ? "Güneşli" : "Parçalı Bulutlu";
                document.getElementById('windVal').innerText = data.current_weather.windspeed;
            }).catch(e => {
                console.log("Hava durumu offline");
            });
        }

        let stepInt;
        function toggleSteps() {
            const el = document.getElementById('stepVal');
            if(stepInt) {
                clearInterval(stepInt);
                stepInt = null;
            } else {
                stepInt = setInterval(() => {
                    el.innerText = parseInt(el.innerText) + Math.floor(Math.random() * 3);
                }, 2000);
            }
        }

        function measurePulse(btn) {
            const display = btn.previousElementSibling; 
            display.innerText = "--";
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            setTimeout(() => {
                const val = Math.floor(Math.random() * (100 - 60) + 60);
                display.innerText = val + " BPM";
                btn.innerHTML = '<i class="fas fa-heart-pulse"></i> Ölç';
            }, 3000);
        }

        function calculateUSD() {
            const toman = parseFloat(document.getElementById('tomanInput').value) || 0;
            const rate = parseFloat(document.getElementById('rateInput').value) || 60000;
            const result = (toman / rate).toFixed(2);
            document.getElementById('usdResult').innerText = "= $" + result;
        }

        function addMsg(text, type) {
            const history = document.getElementById('chatHistory');
            const d = document.createElement('div');
            d.className = `msg ${type}`;
            d.innerText = text;
            history.appendChild(d);
            history.scrollTop = history.scrollHeight;
        }

        async function handleRealChat() {
            const input = document.getElementById('userChatInput');
            const txt = input.value.trim();
            const btn = document.getElementById('sendBtn');
            if(!txt) return;

            addMsg(txt, 'user');
            input.value = '';
            input.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            const systemInstruction = `Sen Piyami LifeOS adlı uygulamanın yapay zeka asistanısın. 
            Çok zeki, bilgili, biraz gizemli ve kendine güvenen bir tarzın var. 
            Kullanıcıya ismiyle hitap etme (ismini bilmiyorsun). 
            Cevapların kısa, net ve etkileyici olsun. 
            Türkçe konuş. Dünyanın en gelişmiş yapay zekası olduğunu hissettir.`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: systemInstruction + "\n\nKullanıcı: " + txt }]
                        }]
                    })
                });

                const data = await response.json();

                if(data.error) {
                    addMsg("⚠️ Bağlantı Hatası: VPN kapalı olabilir veya anahtar geçersiz.", 'bot');
                    console.error(data.error);
                } else {
                    const aiResponse = data.candidates[0].content.parts[0].text;
                    addMsg(aiResponse, 'bot');
                }

            } catch(e) {
                addMsg("⚠️ İnternet Hatası: Lütfen VPN kontrol edin.", 'bot');
            }

            input.disabled = false;
            btn.innerHTML = '<i class="fas fa-paper-plane"></i>';
            input.focus();
        }

        async function translateReal() {
            const txt = document.getElementById('trInput').value.trim();
            const out = document.getElementById('faOutput');
            
            if(!txt) return;
            out.innerText = "Yapay Zeka çeviriyor...";

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: "Aşağıdaki metni Farsça'ya çevir (Sadece Farsça karşılığını yaz, açıklama yapma):\n\n" + txt }]
                        }]
                    })
                });

                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;
                out.innerText = aiText;

            } catch(e) {
                out.innerText = "Hata: İnternet/VPN yok.";
            }
        }

        // Calculator Functions
        function updateCalcDisplay() {
            document.getElementById('calcDisplay').innerText = calcState.current;
            document.getElementById('calcHistory').innerText = calcState.previous + (calcState.operator || '');
            if(calcState.memory !== 0) {
                document.getElementById('calcMemory').innerText = `M: ${calcState.memory}`;
            } else {
                document.getElementById('calcMemory').innerText = '';
            }
        }

        function calcNum(n) {
            if(calcState.current === '0' || calcState.current === 'Error') {
                calcState.current = n;
            } else {
                calcState.current += n;
            }
            updateCalcDisplay();
        }

        function calcOp(op) {
            if(calcState.operator && calcState.previous) {
                calcEquals();
            }
            calcState.previous = calcState.current;
            calcState.current = '0';
            calcState.operator = op;
            updateCalcDisplay();
        }

        function calcEquals() {
            if(!calcState.operator || !calcState.previous) return;
            
            const a = parseFloat(calcState.previous);
            const b = parseFloat(calcState.current);
            let result = 0;

            switch(calcState.operator) {
                case '+': result = a + b; break;
                case '-': result = a - b; break;
                case '*': result = a * b; break;
                case '/': result = b !== 0 ? a / b : 'Error'; break;
            }

            calcState.history.push(`${a} ${calcState.operator} ${b} = ${result}`);
            calcState.current = result.toString();
            calcState.previous = '';
            calcState.operator = null;
            updateCalcDisplay();
        }

        function calcClear() {
            calcState.current = '0';
            calcState.previous = '';
            calcState.operator = null;
            updateCalcDisplay();
        }

        function calcBackspace() {
            if(calcState.current.length > 1) {
                calcState.current = calcState.current.slice(0, -1);
            } else {
                calcState.current = '0';
            }
            updateCalcDisplay();
        }

        function calcPercent() {
            calcState.current = (parseFloat(calcState.current) / 100).toString();
            updateCalcDisplay();
        }

        function calcSqrt() {
            const val = parseFloat(calcState.current);
            calcState.current = val >= 0 ? Math.sqrt(val).toString() : 'Error';
            updateCalcDisplay();
        }

        function calcPower() {
            const val = parseFloat(calcState.current);
            calcState.current = Math.pow(val, 2).toString();
            updateCalcDisplay();
        }

        function calcSin() {
            const val = parseFloat(calcState.current);
            calcState.current = Math.sin(val * Math.PI / 180).toFixed(8).toString();
            updateCalcDisplay();
        }

        function calcCos() {
            const val = parseFloat(calcState.current);
            calcState.current = Math.cos(val * Math.PI / 180).toFixed(8).toString();
            updateCalcDisplay();
        }

        function calcTan() {
            const val = parseFloat(calcState.current);
            calcState.current = Math.tan(val * Math.PI / 180).toFixed(8).toString();
            updateCalcDisplay();
        }

        function calcLog() {
            const val = parseFloat(calcState.current);
            calcState.current = val > 0 ? Math.log10(val).toString() : 'Error';
            updateCalcDisplay();
        }

        function calcLn() {
            const val = parseFloat(calcState.current);
            calcState.current = val > 0 ? Math.log(val).toString() : 'Error';
            updateCalcDisplay();
        }

        function calcPi() {
            calcState.current = Math.PI.toString();
            updateCalcDisplay();
        }

        function calcMemAdd() {
            calcState.memory += parseFloat(calcState.current);
            localStorage.setItem('calc_memory', calcState.memory);
            updateCalcDisplay();
        }

        function calcMemSub() {
            calcState.memory -= parseFloat(calcState.current);
            localStorage.setItem('calc_memory', calcState.memory);
            updateCalcDisplay();
        }

        function calcMemRecall() {
            calcState.current = calcState.memory.toString();
            updateCalcDisplay();
        }

        function calcMemClear() {
            calcState.memory = 0;
            localStorage.removeItem('calc_memory');
            updateCalcDisplay();
        }

        function toggleExtended() {
            const ext = document.getElementById('calcExtended');
            ext.classList.toggle('show');
            const btn = event.target;
            if(ext.classList.contains('show')) {
                btn.innerHTML = '<i class="fas fa-chevron-up"></i> Gelişmiş Fonksiyonlar';
            } else {
                btn.innerHTML = '<i class="fas fa-chevron-down"></i> Gelişmiş Fonksiyonlar';
            }
        }
    </script>
</body>
</html>